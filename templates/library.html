{% extends "base.html" %}
{% block title %}Material Library{% endblock %}
{% block head %}
<style>
    .controls-card { background: white; border-radius: 16px; border: 1px solid #f3f4f6; margin-bottom: 24px; }
    .controls-content { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
    .tabs { background: #fffbeb; padding: 4px; border-radius: 12px; display: flex; gap: 4px; }
    .tab-btn { padding: 8px 16px; border-radius: 8px; font-weight: 700; font-size: 0.875rem; color: #92400e; text-decoration: none; transition: all 0.2s; }
    .tab-btn:hover { background: #fff; color: #d97706; }
    .tab-btn.active { background: #fcd34d; color: #78350f; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .upload-card { background: #fffbeb; border: 2px dashed #fcd34d; padding: 24px; border-radius: 16px; margin-bottom: 32px; }
    .book-card { background: white; border: 1px solid #f3f4f6; transition: all 0.2s; border-radius: 12px; overflow: hidden; }
    .book-card:hover { border-color: #fcd34d; shadow: 0 10px 15px -3px rgba(251, 191, 36, 0.1); transform: translateY(-4px); }
    .book-tag { background: #fef3c7; color: #b45309; padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; }
    .download-link { color: #d97706; font-weight: bold; text-decoration: none; font-size: 0.875rem; display: flex; align-items: center; gap: 4px; margin-top: auto; }
</style>
{% endblock %}

{% block content %}
<div class="max-w-[1200px] mx-auto p-6 fade-in-up">
    <header class="mb-10 bg-white p-8 rounded-3xl border border-slate-200 shadow-sm relative overflow-hidden text-center">
        <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-amber-400 to-orange-400"></div>
        <div class="absolute -right-10 -top-20 w-40 h-40 bg-amber-50 rounded-full blur-3xl opacity-60"></div>
        <div class="relative z-10">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-amber-50 text-amber-600 rounded-2xl text-3xl mb-4 shadow-sm border border-amber-100">üìö</div>
            <h1 class="text-3xl font-black text-slate-800 tracking-tight">Material Library</h1>
            <p class="text-slate-500 mt-2 text-sm font-medium bg-slate-50 inline-block px-4 py-1 rounded-full border border-slate-100">Manage Courseware, Docs & Resources</p>
        </div>
    </header>

    {% if success %}<div class="bg-green-50 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded-lg shadow-sm">{{ success }}</div>{% endif %}
    {% if error %}<div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-lg shadow-sm">{{ error }}</div>{% endif %}

    <div class="controls-card shadow-sm">
        <div class="controls-content">
            <div class="tabs">
                <a href="/library?tab=official&sort={{ sort_option }}" class="tab-btn {% if active_tab == 'official' %}active{% endif %}">üèõÔ∏è Official</a>
                <a href="/library?tab=user&sort={{ sort_option }}" class="tab-btn {% if active_tab == 'user' %}active{% endif %}">‚òÅÔ∏è My Uploads</a>
            </div>
            <form action="/library" method="GET" class="flex items-center gap-2">
                <input type="hidden" name="tab" value="{{ active_tab }}">
                <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Sort by</span>
                <select name="sort" onchange="this.form.submit()" class="p-2 border border-slate-200 rounded-lg bg-white text-sm outline-none">
                    <option value="newest" {% if sort_option == 'newest' %}selected{% endif %}>üïí Newest</option>
                    <option value="oldest" {% if sort_option == 'oldest' %}selected{% endif %}>üìÖ Oldest</option>
                    <option value="a-z" {% if sort_option == 'a-z' %}selected{% endif %}>üî§ A-Z</option>
                </select>
            </form>
        </div>
    </div>

    <div class="{% if active_tab != 'official' %}hidden{% endif %}">
        {% if official_materials|length == 0 %}
            <div class="text-center py-24 bg-slate-50 rounded-2xl border border-dashed border-slate-200 text-slate-400">No official materials yet.</div>
        {% else %}
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6">
                {% for m in official_materials %}
                <div class="book-card flex flex-col h-full group">
                    <div class="h-36 bg-amber-50 flex items-center justify-center text-5xl group-hover:bg-amber-100 transition-colors relative overflow-hidden">
                        {% if m.cover_path %}<img src="/library/cover/{{ m.id }}" class="w-full h-full object-cover">{% else %}üìñ{% endif %}
                    </div>
                    <div class="p-5 flex-1 flex flex-col">
                        <span class="book-tag w-fit mb-2">{{ m.category }}</span>
                        <div class="font-bold text-slate-700 mb-1 truncate text-base">{{ m.filename }}</div>
                        <div class="text-xs text-slate-400 mb-4 font-medium">{{ m.upload_time[:10] }}</div>
                        <a href="/library/download/{{ m.id }}" class="download-link"><span>‚¨áÔ∏è</span> Download</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="{% if active_tab != 'user' %}hidden{% endif %}">
        <div class="upload-card shadow-sm">
            <h3 class="text-amber-800 font-bold mb-4 flex items-center gap-2"><span>‚Üë</span> Upload New Material</h3>
            <form method="POST" enctype="multipart/form-data" class="flex flex-wrap gap-4 items-end">
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-xs font-bold text-slate-500 mb-1.5 uppercase">Files (Batch Supported)</label>
                    <input type="file" name="material_file" multiple required class="w-full p-3 bg-white border border-slate-200 rounded-xl text-sm">
                </div>
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-xs font-bold text-slate-500 mb-1.5 uppercase">Category</label>
                    <div class="flex gap-2">
                        <select name="category_select" class="p-3 border border-slate-200 rounded-xl bg-white flex-1 text-sm outline-none">
                            {% for cat in categories %}<option value="{{ cat }}">{{ cat }}</option>{% endfor %}
                        </select>
                        <input type="text" name="category_new" placeholder="New" class="p-3 border border-slate-200 rounded-xl w-24 text-sm outline-none">
                    </div>
                </div>
                <button type="submit" class="bg-amber-500 text-white px-8 py-3 rounded-xl font-bold hover:bg-amber-600 transition shadow-lg flex items-center gap-2">‚òÅÔ∏è Upload</button>
            </form>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6">
            {% for m in user_materials %}
            <div class="book-card flex flex-col h-full group relative">
                <a href="/library/delete/{{ m.id }}" class="absolute top-2 right-2 w-7 h-7 bg-white/90 rounded-full text-slate-400 hover:text-red-500 flex items-center justify-center font-bold shadow-md opacity-0 group-hover:opacity-100 transition-all z-20">√ó</a>
                <div class="h-36 bg-slate-50 flex items-center justify-center text-5xl">{% if m.cover_path %}<img src="/library/cover/{{ m.id }}" class="w-full h-full object-cover">{% else %}‚òÅÔ∏è{% endif %}</div>
                <div class="p-5 flex-1 flex flex-col">
                    <span class="book-tag w-fit mb-2 bg-slate-100 text-slate-600">{{ m.category }}</span>
                    <div class="font-bold text-slate-700 mb-1 truncate text-base">{{ m.filename }}</div>
                    <a href="/library/download/{{ m.id }}" class="download-link"><span>‚¨áÔ∏è</span> Download</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}